{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Browse Restaurants • Bookify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#f7f7f8; --panel:#fff; --text:#1f2328; --muted:#667085; --line:#e6e7eb;
      --brand:#ff7a1a; --brand-600:#ff6a00; --brand-50:#fff4eb;
      --radius:18px; --shadow:0 6px 24px rgba(0,0,0,.06); --shadow-sm:0 1px 3px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
         font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1120px;margin:0 auto;padding:28px 18px}

    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .title{font-size:32px;font-weight:800;margin:0}
    .bar{display:flex;gap:10px;align-items:center}
    a{color:inherit;text-decoration:none}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      height:36px;padding:0 12px;border-radius:10px;border:1px solid var(--line);
      background:var(--panel);font-weight:600;font-size:14px;box-shadow:var(--shadow-sm);white-space:nowrap
    }
    .btn:hover{background:#fcfcfc}
    .btn.brand{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.brand:hover{background:var(--brand-600)}
    .btn.ghost{background:transparent}
    .btn.full{width:100%}

    .panel{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow)}
    .filters{display:grid;grid-template-columns:2fr 1.4fr auto;gap:10px}
    input{width:100%;height:44px;padding:0 14px;border-radius:12px;border:1px solid var(--line);background:#fff}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{height:32px;padding:0 12px;border-radius:999px;background:#f3f4f6;border:1px solid var(--line);font-size:13px}
    .chip:hover{background:#eef0f3}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px;margin-top:18px}
    .card{
      grid-column:span 12;
      display:flex;align-items:stretch;gap:16px;
      background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);
      padding:16px;box-shadow:var(--shadow);
      min-height:150px;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .card:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(0,0,0,.08)}
    @media (min-width:860px){ .card{grid-column:span 6} }
    @media (min-width:1120px){ .card{grid-column:span 4} }

    .thumb{
      flex:0 0 72px;height:72px;border-radius:12px;background:var(--brand-50);
      display:grid;place-items:center;font-weight:800;color:var(--brand);font-size:18px;border:1px solid #ffe2c8;
      align-self:center;
    }

    .info{flex:1;display:flex;flex-direction:column;justify-content:center;min-width:0}
    .name{
      font-size:17px;font-weight:800;margin:0 0 6px 0;line-height:1.2;
      white-space:normal; overflow-wrap:anywhere;
    }
    .meta{color:var(--muted);font-size:13px;line-height:1.35}
    .meta-row{display:flex;gap:.45rem;flex-wrap:wrap}
    .dot::before{content:"•";color:#c0c3c7}

    .actions{flex:0 0 140px;display:flex;flex-direction:column;gap:8px}
    .spacer{flex:1}
    .badge{
      align-self:stretch;height:24px;display:grid;place-items:center;
      padding:0 10px;border-radius:999px;background:var(--brand-50);color:#b45309;
      border:1px solid #ffd7b0;font-size:11px;white-space:nowrap
    }

    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 class="title">Browse Restaurants</h1>
      <div class="bar">
        <a href="{% url 'home' %}" class="btn ghost">← Home</a>

        {# Role-aware header button (no forced ?next=) #}
        {% if request.user.is_authenticated %}
          {% if request.user.role == 'OWNER' %}
            <a href="{% url 'owner_dashboard' %}" class="btn">Owner dashboard</a>
          {% elif request.user.role == 'STAFF' %}
            <a href="{% url 'staff_dashboard' %}" class="btn">Staff dashboard</a>
          {% else %}
            <a href="{% url 'customer_dashboard' %}" class="btn">My reservations</a>
          {% endif %}
        {% else %}
          <a href="{% url 'login' %}" class="btn">Log in</a>
        {% endif %}
      </div>
    </header>

    <div class="panel" role="region" aria-label="Filters">
      <form class="filters" method="get">
        <label class="sr" for="q">Search</label>
        <input id="q" type="text" name="q" placeholder="Search by name or address…" value="{{ q|default:'' }}">
        <label class="sr" for="cuisine">Cuisine</label>
        <input id="cuisine" type="text" name="cuisine" placeholder="Cuisine (e.g., Italian, Sushi…)" value="{{ cuisine|default:'' }}">
        <button class="btn brand" type="submit">Search</button>
      </form>
      <div class="chips" aria-label="Quick categories">
        <button name="cuisine" value="Lebanese" class="chip" formmethod="get">Lebanese</button>
        <button name="cuisine" value="Burger"   class="chip" formmethod="get">Burger</button>
        <button name="cuisine" value="Sushi"    class="chip" formmethod="get">Sushi</button>
        <button name="cuisine" value="Pizza"    class="chip" formmethod="get">Pizza</button>
        <button name="cuisine" value="Cafe"     class="chip" formmethod="get">Cafe</button>
      </div>
    </div>

    <section class="grid" aria-label="Restaurant results">
      {% for r in restaurants %}
        <article class="card">
          <div class="thumb" aria-hidden="true">{{ r.name|slice:":1" }}</div>

          <div class="info">
            <h3 class="name">{{ r.name }}</h3>
            <div class="meta">
              <div class="meta-row">
                <span>{{ r.cuisine }}</span><span class="dot"></span><span>{{ r.address }}</span>
              </div>
            </div>
          </div>

          <div class="actions">
            {# Role-aware primary button #}
            {% if request.user.is_authenticated %}
              {% if request.user.role == 'CUSTOMER' %}
                <a class="btn brand full" href="{% url 'customer_dashboard' %}">Book now</a>
              {% elif request.user.role == 'OWNER' %}
                <a class="btn brand full" href="{% url 'owner_dashboard' %}">Manage</a>
              {% else %}
                <a class="btn brand full" href="{% url 'staff_dashboard' %}">Manage</a>
              {% endif %}
            {% else %}
              <a class="btn brand full" href="{% url 'login' %}">Book now</a>
            {% endif %}

            <a class="btn full" href="{% url 'restaurant_detail' r.id %}#hours">More info</a>
            <div class="spacer"></div>
            <div class="badge">Open {{ r.opening_time|time:"H:i" }} — {{ r.closing_time|time:"H:i" }}</div>
          </div>
        </article>
      {% empty %}
        <div class="panel">No restaurants found. Try a different search.</div>
      {% endfor %}
    </section>
  </div>
</body>
</html>
