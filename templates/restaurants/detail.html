{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ restaurant.name }} • Bookify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg:#f7f7f8; --panel:#ffffff; --text:#1f2328; --muted:#667085; --line:#e6e7eb;
      --brand:#ff7a1a; --brand-600:#ff6a00; --brand-50:#fff4eb; --radius:18px;
      --shadow:0 6px 24px rgba(0,0,0,.06); --shadow-sm:0 1px 3px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap{max-width:960px; margin:0 auto; padding:24px 18px}

    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:600;
      text-decoration:none;
      color:inherit;
      box-shadow:var(--shadow-sm);
      cursor:pointer;
    }
    .btn:hover{background:#fcfcfc}
    .btn.brand{background:var(--brand); border-color:var(--brand); color:#fff}
    .btn.brand:hover{background:var(--brand-600)}
    .btn.small{
      padding:6px 12px;
      font-size:13px;
    }

    .panel{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
    }
    h1{margin:0; font-size:28px}
    .meta{color:var(--muted); margin-top:6px; font-size:14px}
    .section{margin-top:18px}
    .group{display:flex; gap:10px; flex-wrap:wrap}

    /* Hero restaurant image */
    .rest-photo-hero{
      width:100%;
      max-height:260px;
      object-fit:cover;
      border-radius:14px;
      margin-top:16px;
      border:1px solid var(--line);
    }

    /* Header + rating pill */
    .rest-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:16px;
    }
    .rating-pill{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 10px;
      border-radius:999px;
      background:#ffffff;
      border:1px solid var(--line);
      font-size:13px;
      font-weight:600;
      white-space:nowrap;
    }
    .rating-pill-star{
      font-size:12px;
      color:#16a34a;
      line-height:1;
    }
    .rating-pill-value{
      color:var(--text);
      line-height:1;
    }

    /* Rating section */
    .rating-section{
      border-top:1px solid var(--line);
      margin-top:16px;
      padding-top:16px;
    }
    .rating-form{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:12px;
    }
    .rating-form select{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:14px;
      background:#fff;
    }

    /* Hours block */
    #hours .table{
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:#fff;
    }
    #hours .row{
      display:grid;
      grid-template-columns:1fr auto auto;
      gap:10px;
      padding:12px 14px;
    }
    #hours .row:not(:last-child){border-bottom:1px solid var(--line)}
    #hours .day{font-weight:600}
    #hours .time{font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
  <div class="wrap">
    <p><a class="btn" href="{% url 'restaurant_browse' %}">← Back to list</a></p>

    <article class="panel">
      <header class="rest-header">
        <div>
          <h1>{{ restaurant.name }}</h1>
          <p class="meta">
            {{ restaurant.cuisine }} • {{ restaurant.address }}
            {% if restaurant.price_level %}
              •
              {% for i in "1234" %}
                {% if forloop.counter <= restaurant.price_level %}$ {% endif %}
              {% endfor %}
            {% endif %}
          </p>
        </div>

        {% with rr=restaurant.rating|default:0|floatformat:1 %}
          <div class="rating-pill" aria-label="{{ rr }} out of 5">
            <span class="rating-pill-star">★</span>
            <span class="rating-pill-value">{{ rr }}</span>
          </div>
        {% endwith %}
      </header>

      {% if restaurant.photo %}
        <img src="{{ restaurant.photo.url }}" alt="{{ restaurant.name }} photo" class="rest-photo-hero">
      {% endif %}

      {% if restaurant.description %}
        <p class="section">{{ restaurant.description }}</p>
      {% endif %}

      <!-- Rating section (real rating, not just visual) -->
      <div class="section rating-section">
        <h3 style="margin:0 0 8px 0">Rate this restaurant</h3>

        {% if user.is_authenticated %}
          <form method="post"
                action="{% url 'rate_restaurant' restaurant.pk %}"
                class="rating-form">
            {% csrf_token %}
            <label>
              <span style="margin-right:6px">Your rating:</span>
              <select name="score">
                <option value="1">1 ★</option>
                <option value="2">2 ★★</option>
                <option value="3">3 ★★★</option>
                <option value="4">4 ★★★★</option>
                <option value="5">5 ★★★★★</option>
              </select>
            </label>
            <button type="submit" class="btn small brand">Save rating</button>
          </form>

          {% if user_rating %}
            <p class="meta" style="margin-top:6px">
              You last rated this restaurant {{ user_rating.score }} / 5.
            </p>
          {% endif %}
        {% else %}
          <p class="meta">Log in to rate this restaurant.</p>
        {% endif %}
      </div>

      <!-- CTA (role-aware, no forced ?next) -->
      <div class="section group">
        {% if user.is_authenticated %}
          {% if user.role == 'CUSTOMER' %}
            <a class="btn brand" href="{% url 'customer_dashboard' %}?q={{ restaurant.name|urlencode }}">
              Book this restaurant
            </a>
          {% elif user.role == 'OWNER' %}
            <a class="btn brand" href="{% url 'owner_dashboard' %}">Manage reservations</a>
          {% else %}
            <a class="btn brand" href="{% url 'staff_dashboard' %}">Manage reservations</a>
          {% endif %}
        {% else %}
          <a class="btn brand" href="{% url 'login' %}">Log in to book</a>
        {% endif %}
      </div>

      <!-- Opening hours -->
      <section id="hours" class="section" aria-label="Opening hours">
        <h3 style="margin:0 0 10px 0">Opening hours</h3>
        <div class="table">
          {% for day, open_t, close_t in opening_rows %}
            <div class="row">
              <div class="day">{{ day }}</div>
              <div class="time">
                {% if open_t %}{{ open_t }}{% else %}—{% endif %}
              </div>
              <div class="time">
                – {% if close_t %}{{ close_t }}{% else %}—{% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </section>
    </article>
  </div>
</body>
</html>
